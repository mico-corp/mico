<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MICO: Augmented Reality Plugin tutorials</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MICO
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Modular Interchangeable Computer prOgraming</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d2/d30/tutorial_ar_mplugin.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Augmented Reality Plugin tutorials </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_C__Users_Bardo91_Desktop_mico_doc_tutorials_ar_ar_mplugin_tutorials"></a></p>
<h2><a class="anchor" id="autotoc_md5"></a>
Camera calibration.</h2>
<p>For better undestanding of what is camera calibration, please refer to other great tutorials as the one provided by OpenCV library <a href="https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_calib3d/py_calibration/py_calibration.html">link</a>.</p>
<p>To start, you need to print a calibration chessboard pattern. This can be found in many places on internet. For simplicity, you can download this one:</p>
<div class="image">
<img src="../../chessboard.jpg" alt="" width="320px"/>
</div>
<p>Then run the calibrationApp that is bundled with the AR mico plugin. This app can be ran from command line with the following input arguments.</p>
<p>./calibration_app [cameraIdx] [nPointsBoardVert] [nPointsBoardHoriz] [squareSize (mm)] [outCalibFile]</p>
<p>A windows will pop-up with the stream of the camera you have chosen. If you place the chessboard pattern in front of the camera, a set of coloured points with lines will appear. It means that the camera has detected the pattern and is waiting for you to save an screenshot. In order to do that, left-click on the window. A new message will appear on the terminal saying that an image has been recorder.</p>
<div class="image">
<img src="../../camera_calibration.gif" alt="" width="320px"/>
</div>
<p>We recommend to record at least 12-16 images, placing the calibration pattern at different distances and angles, as shown in the previous gif. Once you have recorded a sufficient number of images, use right-click on the window to stop streaming and start the calibration process. Once it finishes, the application will end and a file will be placed in the location of the folder where the application was ran.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Printing ARUCO markers</h2>
<p>The AR pluging works by detecting specific markers on camera's stream of images. For simplicity, [ARUCO])(<a href="https://www.uco.es/investiga/grupos/ava/node/26">https://www.uco.es/investiga/grupos/ava/node/26</a>) markers have been used. These were deceloped by the university of Cordoba in Spain, and popularized in the field of research and robotics thanks to ROS and OpenCV.</p>
<p>For more information, refere to the developers webpage or OpenCV webpage. In this documentation, we have uploaded two sample aruco markers to be used in this tutorial, but there exists many of them.</p>
<center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><div class="image">
<img src="../../aruco_marker_70.jpg" alt="" width="320px"/>
</div>
  </th><th class="markdownTableHeadNone"><div class="image">
<img src="../../aruco_marker_80.jpg" alt="" width="320px"/>
</div>
   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Aruco marker 1   </td><td class="markdownTableBodyNone">Aruco marker 2   </td></tr>
</table>
</center><p>Print them and proceed to the following section.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Camera position estimation and main coordinate system</h2>
<p>As mentioned in the previous section, the AR system works by detecting ARUCO markers on the camera stream. There are detected using the BlockArucoCoordinates. This block get an input stream of images and output a set of marker detections. These can be filtered using the BlockFilterAruco which get the set of markers and select the desired one by ID. This detections contains two kind of information: The ID of the marker and the 3D pose of it (represented by a 4x4 affine transform matrix). </p><center> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><div class="image">
<img src="../../BlockArucoDetector.png" alt="" width="320px"/>
</div>
  </th><th class="markdownTableHeadNone"><div class="image">
<img src="../../BlockArucoFilter.png" alt="" width="320px"/>
</div>
   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BlockArucoDetector   </td><td class="markdownTableBodyNone">BlockArucoFilter   </td></tr>
</table>
</center><p> At first, create a block for the camera and previsualize the stream in an Image Visualizer. You should have something as in the following image.</p>
<div class="image">
<img src="../../view_camera_stream.png" alt="" width="640px"/>
</div>
<p>With these two simple blocks, you can have access to the stream of the images and visualize it on real time.</p>
<p>Then, the next step is to use that stream to detect the ARUCO markers, and use that information to feed our AR system. Create four new blocks:</p>
<ol type="1">
<li>Block Aruco CS. This block takes the stream of images and outputs the detections. If the ID is set to 0, the <b>all_coordinates</b> out put is enabled and streams all the detected markers. If the id is set to any other number, the <b>coordinates</b> output is enabled, streaming just the data of the marker with that ID. The second argument is the path to the calibration file that we have created at the beginning of this tutorial.</li>
<li>Block filter Aruco CS. This block is used to filter the set of all detected markers from the <b>all_coordinates</b> stream from the Block Aruco CS.</li>
<li>Inverse Transform. This block perform the inverse transformation of a 4x4 affine transformation. The reason for needing this block is explained later in the tutorial.</li>
<li>Block AR viewer. This block instantiate the 3D viewer. Is based in OpenGL and takes to important streams. The first one is the position of the camera from a fixed frame and the second one if the image stream of the camera.</li>
</ol>
<div class="image">
<img src="../../view_ar_viewer_main_coordinate.png" alt="" width="640px"/>
</div>
<p>Up to this point, you should be able to move the camera facing the marker and a 3D axes will appear, indicating the fixed coordinate frame.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Adding new entities</h2>
<p>Now it is time to add more entities to the game. To do that, we will use the other Aruco Marker and two new blocks:</p>
<ol type="1">
<li>Block Mesh. This new block takes as input the path to a mesh file to be display in the AR viewer. This blocks connects underneath with the AR viewer block without any extra connection. The only input is the coordinate of the mesh to be drawn in the viewer.</li>
<li>Multiply Transform. This block takes two 4x4 affine matrices and multiply them.</li>
</ol>
<p>Another Block Aruco filter is needed to get the new ID and the output stream will be connected to the Block Mesh. The result is a 3D visualization of a cool monkey head in front of your table.</p>
<div class="image">
<img src="../../test_ar_monkey.gif" alt="" width="640px"/>
</div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d6/d4f/tutorial_table_of_content.html">Mico tutorials</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
